import{bD as K,bE as e,bF as mt,bG as Ne,bH as gt,bI as xt,r as l,bJ as Be,bK as _t,bL as ft,bM as yt,bN as Ct,bO as St,bP as vt,bQ as bt,bR as jt,bS as Tt,bT as wt,bU as kt,bV as Le,bW as Nt}from"./vendor-7810ac01.js";import{D as Ue,S,I as Ae,P as Lt,T as he,a as At,B as _e,b as It,c as le,d as Oe,C as Pt,e as Ie,L as Et,f as Rt,g as Mt,h as Pe,i as Gt,j as qt,k as Bt,l as M,m as Ut,n as Ot}from"./fluentui-react-63b3d3f8.js";import{e as $t,E as Ft,f as Ht,g as Vt,D as Dt,h as Qt}from"./fluentui-icons-e67e11a4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const a of d.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();const zt=".auth/me",Kt=".auth/refresh",Wt=".auth/logout?post_logout_redirect_uri=/";async function Jt(){const t=await fetch("/auth_setup");if(!t.ok)throw new Error(`auth setup response was not ok: ${t.status}`);return await t.json()}const $=await Jt(),P=$.useLogin,Q=$.requireAccessControl,Xt=$.msalConfig,Yt=$.loginRequest,Zt=$.tokenRequest,$e=()=>window.location.origin+$.msalConfig.auth.redirectUri,es=()=>fetch(Kt).then(t=>t.ok?fetch(zt).then(s=>s.ok?s.json().then(n=>n.length>0?{id_token:n[0].id_token,access_token:n[0].access_token,user_claims:n[0].user_claims.reduce((c,o)=>(c[o.typ]=o.val,c),{})}:null):null):null),G=await es(),ts=()=>{window.location.href=Wt},pe=t=>t?.getActiveAccount()!=null||G!=null,me=t=>G?Promise.resolve(G.access_token):t.acquireTokenSilent({...Zt,redirectUri:$e()}).then(s=>s.accessToken).catch(s=>{console.log(s)});const ss="/assets/github-fab00c2d.svg",ns="_layout_1nrkm_1",os="_header_1nrkm_7",as="_headerContainer_1nrkm_12",rs="_headerTitleContainer_1nrkm_20",is="_headerLogo_1nrkm_28",cs="_headerTitle_1nrkm_20",ls="_headerNavList_1nrkm_37",us="_headerNavPageLink_1nrkm_43",ds="_headerNavPageLinkActive_1nrkm_57",hs="_headerNavLeftMargin_1nrkm_62",ps="_headerRightText_1nrkm_66",ms="_microsoftLogo_1nrkm_71",gs="_githubLogo_1nrkm_76",v={layout:ns,header:os,headerContainer:as,headerTitleContainer:rs,headerLogo:is,headerTitle:cs,headerNavList:ls,headerNavPageLink:us,headerNavPageLinkActive:ds,headerNavLeftMargin:hs,headerRightText:ps,microsoftLogo:ms,githubLogo:gs},xs="_loginButton_m8yze_1",_s={loginButton:xs},fs=()=>{const{instance:t}=K(),s=t.getActiveAccount(),n=(s||G)!=null,c=()=>{t.loginPopup({...Yt,redirectUri:$e()}).catch(a=>console.log(a))},o=()=>{s?t.logoutPopup({mainWindowRedirectUri:"/",account:t.getActiveAccount()}).catch(a=>console.log(a)):ts()},d=`Logout
${s?.username??G?.user_claims?.preferred_username}`;return e.jsx(Ue,{text:n?d:"Login",className:_s.loginButton,onClick:n?o:c})},Ee=()=>e.jsxs("div",{className:v.layout,children:[e.jsx("header",{className:v.header,role:"banner",children:e.jsxs("div",{className:v.headerContainer,children:[e.jsx(mt,{to:"/",className:v.headerTitleContainer,children:e.jsx("h3",{className:v.headerTitle,children:"GPT + Enterprise data | Sample"})}),e.jsx("nav",{children:e.jsxs("ul",{className:v.headerNavList,children:[e.jsx("li",{children:e.jsx(Ne,{to:"/",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Chat"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx(Ne,{to:"/qa",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Ask a question"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e.jsx("img",{src:ss,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:v.githubLogo})})})]})}),e.jsx("h4",{className:v.headerRightText,children:"Azure OpenAI + AI Search"}),P&&e.jsx(fs,{})]})}),e.jsx(gt,{})]}),ys="_container_18ti9_1",Cs="_chatRoot_18ti9_8",Ss="_chatContainer_18ti9_13",vs="_chatEmptyState_18ti9_21",bs="_chatEmptyStateTitle_18ti9_31",js="_chatEmptyStateSubtitle_18ti9_38",Ts="_chatMessageStream_18ti9_54",ws="_chatMessageGpt_18ti9_66",ks="_chatMessageGptMinWidth_18ti9_73",Ns="_chatInput_18ti9_78",Ls="_chatAnalysisPanel_18ti9_91",As="_chatSettingsSeparator_18ti9_99",Is="_loadingLogo_18ti9_103",Ps="_commandsContainer_18ti9_107",Es="_commandButton_18ti9_112",p={container:ys,chatRoot:Cs,chatContainer:Ss,chatEmptyState:vs,chatEmptyStateTitle:bs,chatEmptyStateSubtitle:js,chatMessageStream:Ts,chatMessageGpt:ws,chatMessageGptMinWidth:ks,chatInput:Ns,chatAnalysisPanel:Ls,chatSettingsSeparator:As,loadingLogo:Is,commandsContainer:Ps,commandButton:Es},te="";function se(t){var s={"Content-Type":"application/json"};return P&&G==null&&t&&(s.Authorization=`Bearer ${t}`),s}async function zn(t,s){const n=await fetch(`${te}/ask`,{method:"POST",headers:se(s),body:JSON.stringify(t)}),c=await n.json();if(n.status>299||!n.ok)throw Error(c.error||"Unknown error");return c}async function Rs(t){return await(await fetch(`${te}/config`,{method:"GET",headers:se(t)})).json()}async function Ms(t,s){return await fetch(`${te}/chat`,{method:"POST",headers:se(s),body:JSON.stringify(t)})}function Fe(t){return`${te}/content/${t}`}var j=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(j||{}),I=(t=>(t.TextAndImages="textAndImages",t.Images="images",t.Texts="texts",t))(I||{}),k=(t=>(t.Embedding="embedding",t.ImageEmbedding="imageEmbedding",t.Both="both",t))(k||{});const Gs="_answerContainer_1sqax_1",qs="_answerLogo_1sqax_11",Bs="_answerText_1sqax_15",Us="_selected_1sqax_34",Os="_citationLearnMore_1sqax_38",$s="_citation_1sqax_38",Fs="_followupQuestionsList_1sqax_60",Hs="_followupQuestionLearnMore_1sqax_64",Vs="_followupQuestion_1sqax_60",Ds="_supContainer_1sqax_83",Qs="_retryButton_1sqax_112",zs="_loadingdots_1sqax_134",Ks="_loading_1sqax_134",b={answerContainer:Gs,answerLogo:qs,answerText:Bs,selected:Us,citationLearnMore:Os,citation:$s,followupQuestionsList:Fs,followupQuestionLearnMore:Hs,followupQuestion:Vs,supContainer:Ds,retryButton:Qs,loadingdots:zs,loading:Ks};function Ws(t,s,n){const c=[];let o=t.trim();if(s){let u=o.length;for(let m=o.length-1;m>=0&&o[m]!=="]";m--)if(o[m]==="["){u=m;break}o=o.substring(0,u)}return{answerHtml:o.split(/\[([^\]]+)\]/g).map((u,g)=>{if(g%2===0)return u;{let m;c.indexOf(u)!==-1?m=c.indexOf(u)+1:(c.push(u),m=c.length);const h=Fe(u);return xt(e.jsx("a",{className:"supContainer",title:u,onClick:()=>n(h),children:e.jsx("sup",{children:m})}))}}).join(""),citations:c}}const He=()=>e.jsx($t,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),Re=({answer:t,isSelected:s,isStreaming:n,onCitationClicked:c,onThoughtProcessClicked:o,onSupportingContentClicked:d,onFollowupQuestionClicked:a,showFollowupQuestions:u})=>{const g=t.choices[0].context.followup_questions,m=t.choices[0].message.content,h=l.useMemo(()=>Ws(m,n,c),[t]),x=Be.sanitize(h.answerHtml);return e.jsxs(S,{className:`${b.answerContainer} ${s&&b.selected}`,verticalAlign:"space-between",children:[e.jsx(S.Item,{children:e.jsxs(S,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(He,{}),e.jsxs("div",{children:[e.jsx(Ae,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>o(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Ae,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>d(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(S.Item,{grow:!0,children:e.jsx("div",{className:b.answerText,dangerouslySetInnerHTML:{__html:x}})}),!!h.citations.length&&e.jsx(S.Item,{children:e.jsxs(S,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:b.citationLearnMore,children:"Citations:"}),h.citations.map((_,y)=>{const L=Fe(_);return e.jsx("a",{className:b.citation,title:_,onClick:()=>c(L),children:`${++y}. ${_}`},y)})]})}),!!g?.length&&u&&a&&e.jsx(S.Item,{children:e.jsxs(S,{horizontal:!0,wrap:!0,className:`${h.citations.length?b.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:b.followupQuestionLearnMore,children:"Follow-up questions:"}),g.map((_,y)=>e.jsx("a",{className:b.followupQuestion,title:_,onClick:()=>a(_),children:`${_}`},y))]})})]})},Js=()=>{const t=_t({from:{opacity:0},to:{opacity:1}});return e.jsx(ft.div,{style:{...t},children:e.jsxs(S,{className:b.answerContainer,verticalAlign:"space-between",children:[e.jsx(He,{}),e.jsx(S.Item,{grow:!0,children:e.jsxs("p",{className:b.answerText,children:["Generating answer",e.jsx("span",{className:b.loadingdots})]})})]})})},Xs=({error:t,onRetry:s})=>e.jsxs(S,{className:b.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ft,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(S.Item,{grow:!0,children:e.jsx("p",{className:b.answerText,children:t})}),e.jsx(Lt,{className:b.retryButton,onClick:s,text:"Retry"})]}),Ys="_questionInputContainer_hiipw_1",Zs="_questionInputTextArea_hiipw_12",en="_questionInputButtonsContainer_hiipw_17",ue={questionInputContainer:Ys,questionInputTextArea:Zs,questionInputButtonsContainer:en},tn=({onSend:t,disabled:s,placeholder:n,clearOnSend:c,initQuestion:o})=>{const[d,a]=l.useState("");l.useEffect(()=>{o&&a(o)},[o]);const u=()=>{s||!d.trim()||(t(d),c&&a(""))},g=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),u())},m=(y,L)=>{L?L.length<=1e3&&a(L):a("")},{instance:h}=K(),x=Q&&!pe(h),_=s||!d.trim()||x;return x&&(n="Please login to continue..."),e.jsxs(S,{horizontal:!0,className:ue.questionInputContainer,children:[e.jsx(he,{className:ue.questionInputTextArea,disabled:x,placeholder:n,multiline:!0,resizable:!1,borderless:!0,value:d,onChange:m,onKeyDown:g}),e.jsx("div",{className:ue.questionInputButtonsContainer,children:e.jsx(At,{content:"Ask question button",relationship:"label",children:e.jsx(_e,{size:"large",icon:e.jsx(Ht,{primaryFill:"rgba(115, 118, 225, 1)"}),disabled:_,onClick:u})})})]})},sn="_examplesNavList_o3hyg_1",nn="_example_o3hyg_1",on="_exampleText_o3hyg_29",ge={examplesNavList:sn,example:nn,exampleText:on},an=({text:t,value:s,onClick:n})=>e.jsx("div",{className:ge.example,onClick:()=>n(s),children:e.jsx("p",{className:ge.exampleText,children:t})}),rn=["What is included in my Northwind Health Plus plan that is not in standard?","What happens in a performance review?","What does a Product Manager do?"],cn=["Compare the impact of interest rates and GDP in financial markets.","What is the expected trend for the S&P 500 index over the next five years? Compare it to the past S&P 500 performance","Can you identify any correlation between oil prices and stock market trends?"],ln=({onExampleClicked:t,useGPT4V:s})=>e.jsx("ul",{className:ge.examplesNavList,children:(s?cn:rn).map((n,c)=>e.jsx("li",{children:e.jsx(an,{text:n,value:n,onClick:t})},c))}),un="_container_1p3pb_1",dn="_message_1p3pb_9",Me={container:un,message:dn},ee=({message:t})=>e.jsx("div",{className:Me.container,children:e.jsx("div",{className:Me.message,children:t})}),hn="_thoughtProcess_1nmyh_1",pn="_tList_1nmyh_8",mn="_tListItem_1nmyh_14",gn="_tStep_1nmyh_40",xn="_tCodeBlock_1nmyh_46",_n="_tProp_1nmyh_50",fn="_citationImg_1nmyh_58",O={thoughtProcess:hn,tList:pn,tListItem:mn,tStep:gn,tCodeBlock:xn,tProp:_n,citationImg:fn};function yn(t){const s=t.split(": "),n=s[0],c=Be.sanitize(s.slice(1).join(": "));return{title:n,content:c}}const Cn="_supportingContentNavList_beb5d_1",Sn="_supportingContentItem_beb5d_9",vn="_supportingContentItemHeader_beb5d_23",bn="_supportingContentItemText_beb5d_27",jn="_supportingContentItemImage_beb5d_32",z={supportingContentNavList:Cn,supportingContentItem:Sn,supportingContentItemHeader:vn,supportingContentItemText:bn,supportingContentItemImage:jn},Tn=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,n=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:z.supportingContentNavList,children:[s.map(c=>{const o=yn(c);return e.jsx(wn,{...o})}),n?.map(c=>e.jsx("img",{className:z.supportingContentItemImage,src:c.url}))]})},wn=({title:t,content:s})=>e.jsxs("li",{className:z.supportingContentItem,children:[e.jsx("h4",{className:z.supportingContentItemHeader,children:t}),e.jsx("p",{className:z.supportingContentItemText,dangerouslySetInnerHTML:{__html:s}})]});var N=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(N||{});const kn=({thoughts:t})=>e.jsx("ul",{className:O.tList,children:t.map(s=>e.jsxs("li",{className:O.tListItem,children:[e.jsx("div",{className:O.tStep,children:s.title}),Array.isArray(s.description)?e.jsx(yt,{language:"json",wrapLongLines:!0,className:O.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.description}),e.jsx(S,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(n=>e.jsxs("span",{className:O.tProp,children:[n,": ",JSON.stringify(s.props?.[n])]}))})]})]}))}),de={disabled:!0,style:{color:"grey"}},Nn=({answer:t,activeTab:s,activeCitation:n,citationHeight:c,className:o,onActiveTabChanged:d})=>{const a=!t.choices[0].context.thoughts,u=!t.choices[0].context.data_points,g=!n,[m,h]=l.useState(""),x=P?K().instance:void 0,_=async()=>{const y=x?await me(x):void 0;if(n){const ne=await(await fetch(n,{method:"GET",headers:se(y)})).blob(),q=URL.createObjectURL(ne);h(q)}};return l.useEffect(()=>{_()},[]),e.jsxs(It,{className:o,selectedKey:s,onLinkClick:y=>y&&d(y.props.itemKey),children:[e.jsx(le,{itemKey:N.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:a?de:void 0,children:e.jsx(kn,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(le,{itemKey:N.SupportingContentTab,headerText:"Supporting content",headerButtonProps:u?de:void 0,children:e.jsx(Tn,{supportingContent:t.choices[0].context.data_points})}),e.jsx(le,{itemKey:N.CitationTab,headerText:"Citation",headerButtonProps:g?de:void 0,children:n?.endsWith(".png")?e.jsx("img",{src:m,className:O.citationImg}):e.jsx("iframe",{title:"Citation",src:m,width:"100%",height:c})})]})},Ln="_container_cfwv2_1",An={container:Ln},In=({className:t,onClick:s})=>e.jsx("div",{className:`${An.container} ${t??""}`,children:e.jsx(_e,{icon:e.jsx(Vt,{}),onClick:s,children:"Developer settings"})}),Pn="_container_cfwv2_1",En={container:Pn},Rn=({className:t,disabled:s,onClick:n})=>e.jsx("div",{className:`${En.container} ${t??""}`,children:e.jsx(_e,{icon:e.jsx(Dt,{}),disabled:s,onClick:n,children:"Clear chat"})}),Mn="_container_1pzrp_1",Ge={container:Mn},Gn=[{key:k.Embedding,text:"Text Embeddings"},{key:k.ImageEmbedding,text:"Image Embeddings"},{key:k.Both,text:"Text and Image embeddings"}],qn=({updateRetrievalMode:t,updateVectorFields:s,showImageOptions:n})=>{const[c,o]=l.useState(j.Hybrid),[d,a]=l.useState(),u=(m,h)=>{o(h?.data||j.Hybrid),t(h?.data||j.Hybrid)},g=(m,h)=>{h&&a(h.key);let x;h?.key==="both"?x=[k.Embedding,k.ImageEmbedding]:x=[h?.key],s(x)};return l.useEffect(()=>{s(n?[k.Embedding,k.ImageEmbedding]:[k.Embedding])},[n]),e.jsxs(S,{className:Ge.container,tokens:{childrenGap:10},children:[e.jsx(Oe,{className:Ge.oneshotSettingsSeparator,label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:c==j.Hybrid,data:j.Hybrid},{key:"vectors",text:"Vectors",selected:c==j.Vectors,data:j.Vectors},{key:"text",text:"Text",selected:c==j.Text,data:j.Text}],required:!0,onChange:u}),n&&[j.Vectors,j.Hybrid].includes(c)&&e.jsx(Pt,{options:Gn,onChange:g,selectedKey:d,defaultSelectedKey:k.Both,label:"Vector Fields (Multi-query vector search)"})]})},Bn=()=>{const{instance:t}=K(),s=t.getActiveAccount(),n=a=>typeof a=="string"?a:JSON.stringify(a),o=(a=>Object.keys(a??{}).map(u=>{let g=u;try{const h=new URL(u).pathname.split("/");u=h[h.length-1]}catch{}return{name:u,value:n((a??{})[g])}}))(s?.idTokenClaims??G?.user_claims),d=[Ie({columnId:"name",compare:(a,u)=>a.name.localeCompare(u.name),renderHeaderCell:()=>"Name",renderCell:a=>a.name}),Ie({columnId:"value",compare:(a,u)=>a.value.localeCompare(u.value),renderHeaderCell:()=>"Value",renderCell:a=>a.value})];return e.jsxs("div",{children:[e.jsx(Et,{children:"ID Token Claims"}),e.jsxs(Rt,{items:o,columns:d,sortable:!0,getRowId:a=>a.name,children:[e.jsx(Mt,{children:e.jsx(Pe,{children:({renderHeaderCell:a})=>e.jsx(Gt,{children:a()})})}),e.jsx(qt,{children:({item:a,rowId:u})=>e.jsx(Pe,{children:({renderCell:g})=>e.jsx(Bt,{children:g(a)})},u)})]})]})},Un="_container_1pzrp_1",qe={container:Un},On=({updateGPT4VInputs:t,updateUseGPT4V:s,isUseGPT4V:n,gpt4vInputs:c})=>{const[o,d]=l.useState(n),[a,u]=l.useState(c||I.TextAndImages),g=(h,x)=>{s(!!x),d(!!x)},m=(h,x)=>{if(x){const _=x.key;t(_||I.TextAndImages),_&&u(_)}};return l.useEffect(()=>{o&&t(I.TextAndImages)},[o]),e.jsxs(S,{className:qe.container,tokens:{childrenGap:10},children:[e.jsx(M,{checked:o,label:"Use GPT-4 Turbo with Vision",onChange:g}),o&&e.jsx(Oe,{selectedKey:a,className:qe.oneshotSettingsSeparator,label:"GPT-4 Turbo with Vision Inputs",options:[{key:I.TextAndImages,text:"Images and text from index"},{text:"Images only",key:I.Images},{text:"Text only",key:I.Texts}],required:!0,onChange:m})]})},$n=()=>{const[t,s]=l.useState(!1),[n,c]=l.useState(""),[o,d]=l.useState(3),[a,u]=l.useState(j.Hybrid),[g,m]=l.useState(!0),[h,x]=l.useState(!0),[_,y]=l.useState(!1),[L,ne]=l.useState(""),[q,Ve]=l.useState(!1),[De,Qe]=l.useState([k.Embedding]),[fe,ze]=l.useState(!1),[ye,Ke]=l.useState(!1),[Ce,We]=l.useState(I.TextAndImages),[W,Je]=l.useState(!1),E=l.useRef(""),oe=l.useRef(null),[J,X]=l.useState(!1),[Se,ae]=l.useState(!1),[Y,re]=l.useState(),[ve,ie]=l.useState(),[F,B]=l.useState(void 0),[H,be]=l.useState(0),[T,Z]=l.useState([]),[je,Te]=l.useState([]),[we,Xe]=l.useState(!1),Ye=async()=>{const r=U?await me(U):void 0;Rs(r).then(i=>{Xe(i.showGPT4VOptions)})},Ze=async(r,i,w,ce)=>{let A="",f={};const dt=C=>new Promise(ht=>{setTimeout(()=>{A+=C;const pt={...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]};Te([...i,[r,pt]]),ht(null)},33)});try{ae(!0);for await(const C of Ct(ce))if(C.choices&&C.choices[0].context&&C.choices[0].context.data_points)C.choices[0].message=C.choices[0].delta,f=C;else if(C.choices&&C.choices[0].delta.content)X(!1),await dt(C.choices[0].delta.content);else if(C.choices&&C.choices[0].context)f.choices[0].context={...f.choices[0].context,...C.choices[0].context};else if(C.error)throw Error(C.error)}finally{ae(!1)}return{...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]}},U=P?K().instance:void 0,V=async r=>{E.current=r,Y&&re(void 0),X(!0),ie(void 0),B(void 0);const i=U?await me(U):void 0;try{const ce={messages:[...T.flatMap(f=>[{content:f[0],role:"user"},{content:f[1].choices[0].message.content,role:"assistant"}]),{content:r,role:"user"}],stream:h,context:{overrides:{prompt_template:n.length===0?void 0:n,exclude_category:L.length===0?void 0:L,top:o,retrieval_mode:a,semantic_ranker:g,semantic_captions:_,suggest_followup_questions:q,use_oid_security_filter:fe,use_groups_security_filter:ye,vector_fields:De,use_gpt4v:W,gpt4v_input:Ce}},session_state:T.length?T[T.length-1][1].choices[0].session_state:null},A=await Ms(ce,i);if(!A.body)throw Error("No response body");if(h){const f=await Ze(r,T,Z,A.body);Z([...T,[r,f]])}else{const f=await A.json();if(A.status>299||!A.ok)throw Error(f.error||"Unknown error");Z([...T,[r,f]])}}catch(w){re(w)}finally{X(!1)}},et=()=>{E.current="",Y&&re(void 0),ie(void 0),B(void 0),Z([]),Te([]),X(!1),ae(!1)};l.useEffect(()=>oe.current?.scrollIntoView({behavior:"smooth"}),[J]),l.useEffect(()=>oe.current?.scrollIntoView({behavior:"auto"}),[je]),l.useEffect(()=>{Ye()},[]);const tt=(r,i)=>{c(i||"")},st=(r,i)=>{d(parseInt(i||"3"))},nt=(r,i)=>{m(!!i)},ot=(r,i)=>{y(!!i)},at=(r,i)=>{x(!!i)},rt=(r,i)=>{ne(i||"")},it=(r,i)=>{Ve(!!i)},ct=(r,i)=>{ze(!!i)},lt=(r,i)=>{Ke(!!i)},ut=r=>{V(r)},ke=(r,i)=>{ve===r&&F===N.CitationTab&&H===i?B(void 0):(ie(r),B(N.CitationTab)),be(i)},D=(r,i)=>{B(F===r&&H===i?void 0:r),be(i)};return e.jsxs("div",{className:p.container,children:[e.jsxs("div",{className:p.commandsContainer,children:[e.jsx(Rn,{className:p.commandButton,onClick:et,disabled:!E.current||J}),e.jsx(In,{className:p.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:p.chatRoot,children:[e.jsxs("div",{className:p.chatContainer,children:[E.current?e.jsxs("div",{className:p.chatMessageStream,children:[Se&&je.map((r,i)=>e.jsxs("div",{children:[e.jsx(ee,{message:r[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Re,{isStreaming:!0,answer:r[1],isSelected:!1,onCitationClicked:w=>ke(w,i),onThoughtProcessClicked:()=>D(N.ThoughtProcessTab,i),onSupportingContentClicked:()=>D(N.SupportingContentTab,i),onFollowupQuestionClicked:w=>V(w),showFollowupQuestions:q&&T.length-1===i},i)})]},i)),!Se&&T.map((r,i)=>e.jsxs("div",{children:[e.jsx(ee,{message:r[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Re,{isStreaming:!1,answer:r[1],isSelected:H===i&&F!==void 0,onCitationClicked:w=>ke(w,i),onThoughtProcessClicked:()=>D(N.ThoughtProcessTab,i),onSupportingContentClicked:()=>D(N.SupportingContentTab,i),onFollowupQuestionClicked:w=>V(w),showFollowupQuestions:q&&T.length-1===i},i)})]},i)),J&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(Js,{})})]}),Y?e.jsxs(e.Fragment,{children:[e.jsx(ee,{message:E.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(Xs,{error:Y.toString(),onRetry:()=>V(E.current)})})]}):null,e.jsx("div",{ref:oe})]}):e.jsxs("div",{className:p.chatEmptyState,children:[e.jsx(Qt,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:p.chatEmptyStateTitle,children:"Chat with your data"}),e.jsx("h2",{className:p.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(ln,{onExampleClicked:ut,useGPT4V:W})]}),e.jsx("div",{className:p.chatInput,children:e.jsx(tn,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:J,onSend:r=>V(r)})})]}),T.length>0&&F&&e.jsx(Nn,{className:p.chatAnalysisPanel,activeCitation:ve,onActiveTabChanged:r=>D(r,H),citationHeight:"810px",answer:T[H][1],activeTab:F}),e.jsxs(Ut,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(Ue,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(he,{className:p.chatSettingsSeparator,defaultValue:n,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:tt}),e.jsx(Ot,{className:p.chatSettingsSeparator,label:"Retrieve this many search results:",min:1,max:50,defaultValue:o.toString(),onChange:st}),e.jsx(he,{className:p.chatSettingsSeparator,label:"Exclude category",onChange:rt}),e.jsx(M,{className:p.chatSettingsSeparator,checked:g,label:"Use semantic ranker for retrieval",onChange:nt}),e.jsx(M,{className:p.chatSettingsSeparator,checked:_,label:"Use query-contextual summaries instead of whole documents",onChange:ot,disabled:!g}),e.jsx(M,{className:p.chatSettingsSeparator,checked:q,label:"Suggest follow-up questions",onChange:it}),we&&e.jsx(On,{gpt4vInputs:Ce,isUseGPT4V:W,updateUseGPT4V:r=>{Je(r)},updateGPT4VInputs:r=>We(r)}),e.jsx(qn,{showImageOptions:W&&we,updateVectorFields:r=>Qe(r),updateRetrievalMode:r=>u(r)}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:fe||Q,label:"Use oid security filter",disabled:!pe(U)||Q,onChange:ct}),P&&e.jsx(M,{className:p.chatSettingsSeparator,checked:ye||Q,label:"Use groups security filter",disabled:!pe(U)||Q,onChange:lt}),e.jsx(M,{className:p.chatSettingsSeparator,checked:h,label:"Stream chat completion responses",onChange:at}),P&&e.jsx(Bn,{})]})]})]})};var xe;if(P){var R=new St(Xt);!R.getActiveAccount()&&R.getAllAccounts().length>0&&R.setActiveAccount(R.getActiveAccount()),R.addEventCallback(t=>{if(t.eventType===vt.LOGIN_SUCCESS&&t.payload){const s=t.payload;R.setActiveAccount(s)}}),xe=e.jsx(Nt,{instance:R,children:e.jsx(Ee,{})})}else xe=e.jsx(Ee,{});bt();const Fn=jt([{path:"/",element:xe,children:[{index:!0,element:e.jsx($n,{})},{path:"qa",lazy:()=>Le(()=>import("./OneShot-9f60fd5b.js"),["assets/OneShot-9f60fd5b.js","assets/vendor-7810ac01.js","assets/fluentui-react-63b3d3f8.js","assets/fluentui-icons-e67e11a4.js","assets/OneShot-daa12333.css"])},{path:"*",lazy:()=>Le(()=>import("./NoPage-ea4b1efc.js"),["assets/NoPage-ea4b1efc.js","assets/vendor-7810ac01.js"])}]}]);Tt.createRoot(document.getElementById("root")).render(e.jsx(wt.StrictMode,{children:e.jsx(kt,{router:Fn})}));export{Re as A,ln as E,I as G,tn as Q,j as R,In as S,Bn as T,k as V,N as a,Xs as b,Nn as c,On as d,qn as e,Rs as f,me as g,zn as h,pe as i,Q as r,P as u};
//# sourceMappingURL=index-d51dc33e.js.map
